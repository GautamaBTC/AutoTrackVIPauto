<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#001F3F" /> <!-- Начальный цвет для темной темы -->
  <title>VIPавто — Облачный журнал</title>
  
  <!-- Стили -->
  <link rel="stylesheet" href="assets/css/reset.css" />
  <link rel="stylesheet" href="assets/css/main.css" />

  <!-- Шрифты и иконки -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
</head>
<body>
  <!-- Хедер -->
  <header class="page-header">
    <div class="page-header__left">
      <div class="user-menu">
        <button class="user-menu-trigger" id="user-menu-trigger" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-user-circle"></i>
          <span id="user-name">Загрузка...</span>
          <span id="user-role" class="text-muted">Загрузка...</span>
          <i class="fas fa-chevron-down menu-arrow"></i>
        </button>
        <div class="user-menu-dropdown hidden" id="user-menu-dropdown" role="menu">
          <button class="menu-btn" id="logout-btn" role="menuitem">
            <i class="fas fa-arrow-right-from-bracket"></i> Выйти
          </button>
        </div>
      </div>
    </div>

    <div class="page-header__center">
      <span id="current-date">…</span>
      <span id="current-time">–:–</span>
    </div>

    <div class="page-header__right">
      <label class="theme-switch" title="Сменить тему">
        <input type="checkbox" id="theme-toggle" />
        <span class="slider">
           <span class="slider-thumb">
                <i class="fas fa-moon"></i>
                <i class="fas fa-sun"></i>
           </span>
        </span>
      </label>
    </div>
  </header>

  <!-- Основной контент -->
  <main class="app-container">
    <!-- Интерфейс мастера -->
    <section id="master-interface" class="interface-container hidden" aria-labelledby="master-view-title">
      <h2 id="master-view-title" class="visually-hidden">Интерфейс мастера</h2>
      
      <div class="kpi-grid">
        <div class="stat-card">
          <div class="stat-header">
            <i class="fas fa-sack-dollar"></i>
            <h3>Сегодня</h3>
          </div>
          <div class="stat-value" id="master-today-earnings">0 ₽</div>
        </div>
        <div class="stat-card">
          <div class="stat-header">
            <i class="fas fa-calendar-days"></i>
            <h3>Месяц</h3>
          </div>
          <div class="stat-value" id="master-month-earnings">0 ₽</div>
        </div>
        <div class="stat-card">
          <div class="stat-header">
            <i class="fas fa-list-check"></i>
            <h3>Работы</h3>
          </div>
          <div class="stat-value" id="master-jobs-count">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-header">
            <i class="fas fa-star"></i>
            <h3>Бонус</h3>
          </div>
          <div class="stat-value">
            <span id="master-bonus-level">0</span>
            <div class="bonus-stars" id="master-bonus-stars">
              <!-- Звезды будут заполняться скриптом -->
            </div>
          </div>
        </div>
      </div>

      <div class="quick-actions">
        <button class="quick-action-btn primary-btn" id="add-job-btn">
          <i class="fas fa-plus"></i> Добавить работу
        </button>
        <button class="quick-action-btn secondary-btn" id="view-graph-btn">
          <i class="fas fa-chart-line"></i> График активности
        </button>
      </div>

      <div class="section-header">
        <h3>История работ</h3>
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="jobs-search" placeholder="Поиск по авто или услугам...">
        </div>
      </div>

      <div class="filters-bar">
        <select id="jobs-period-filter">
          <option value="all">Все время</option>
          <option value="today">Сегодня</option>
          <option value="week">Неделя</option>
          <option value="month" selected>Месяц</option>
        </select>
        <select id="jobs-type-filter">
          <option value="all">Все типы</option>
          <option value="repair">Ремонт</option>
          <option value="service">Обслуживание</option>
          <option value="upgrade">Улучшения</option>
        </select>
      </div>

      <div id="master-jobs-list" class="entries-list" role="list" aria-live="polite">
        <!-- Карточки работ будут добавляться сюда -->
        <div class="no-entries" role="status">
            <i class="fas fa-folder-open"></i>
            <p>Нет записей для отображения</p>
        </div>
      </div>
    </section>

    <!-- Интерфейс администратора/директора -->
    <section id="admin-interface" class="interface-container hidden" aria-labelledby="admin-view-title">
      <h2 id="admin-view-title" class="visually-hidden">Интерфейс администратора</h2>
      
      <div class="tab-navigation" role="tablist">
        <button class="tab-btn active" data-tab="overview-tab" role="tab" aria-selected="true" aria-controls="overview-tab">Обзор</button>
        <button class="tab-btn" data-tab="masters-tab" role="tab" aria-selected="false" aria-controls="masters-tab">Мастера</button>
        <button class="tab-btn" data-tab="analytics-tab" role="tab" aria-selected="false" aria-controls="analytics-tab">Аналитика</button>
      </div>
      <div class="tab-indicator"></div>

      <!-- Вкладка обзора -->
      <div id="overview-tab" class="tab-pane" role="tabpanel" aria-labelledby="tab-overview">
        <div class="kpi-grid">
          <div class="stat-card">
            <div class="stat-header">
              <i class="fas fa-sack-dollar"></i>
              <h3>Выручка за месяц</h3>
            </div>
            <div class="stat-value" id="total-revenue">0 ₽</div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <i class="fas fa-users"></i>
              <h3>Активные мастера</h3>
            </div>
            <div class="stat-value" id="active-masters">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <i class="fas fa-list-check"></i>
              <h3>Работы за месяц</h3>
            </div>
            <div class="stat-value" id="total-jobs">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <i class="fas fa-chart-line"></i>
              <h3>Рост (месяц к месяцу)</h3>
            </div>
            <div class="stat-value text-success" id="revenue-growth">+0%</div>
          </div>
        </div>

        <div class="charts-grid">
          <div class="chart-container">
            <h4>Выручка по дням</h4>
            <canvas id="revenue-chart"></canvas>
          </div>
          <div class="chart-container">
            <h4>Распределение по мастерам</h4>
            <canvas id="distribution-chart"></canvas>
          </div>
        </div>
      </div>

      <!-- Вкладка мастеров -->
      <div id="masters-tab" class="tab-pane hidden" role="tabpanel" aria-labelledby="tab-masters">
        <div class="section-header">
          <h3>Список мастеров</h3>
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="masters-search" placeholder="Поиск мастера...">
          </div>
        </div>
        
        <div class="view-toggle">
          <button class="icon-btn active" id="view-cards" title="Карточки">
            <i class="fas fa-table-cells"></i>
          </button>
          <button class="icon-btn" id="view-list" title="Список">
            <i class="fas fa-list"></i>
          </button>
        </div>

        <div id="masters-grid" class="masters-grid">
          <!-- Карточки мастеров будут добавляться сюда -->
        </div>
      </div>

      <!-- Вкладка аналитики -->
      <div id="analytics-tab" class="tab-pane hidden" role="tabpanel" aria-labelledby="tab-analytics">
        <div class="analytics-filters">
          <div class="filter-group">
            <label for="period-select">Период:</label>
            <select id="period-select">
              <option value="week">Неделя</option>
              <option value="month" selected>Месяц</option>
              <option value="quarter">Квартал</option>
              <option value="year">Год</option>
              <option value="custom">Свой период</option>
            </select>
          </div>
          
          <div id="custom-period" class="filter-group hidden">
            <input type="date" id="date-from">
            <span>—</span>
            <input type="date" id="date-to">
          </div>
          
          <button id="apply-filters" class="primary-btn">
            <i class="fas fa-check"></i> Применить
          </button>
          
          <button id="export-data" class="secondary-btn">
            <i class="fas fa-download"></i> Экспорт
          </button>
        </div>

        <div class="charts-grid">
          <div class="chart-container">
            <h4>ТОП услуг</h4>
            <canvas id="services-chart"></canvas>
          </div>
          <div class="chart-container">
            <h4>Динамика показателей</h4>
            <canvas id="trends-chart"></canvas>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Модальные окна -->
  <!-- Модальное окно добавления/редактирования работы -->
  <div id="add-job-modal" class="modal" role="dialog" aria-labelledby="add-job-modal-title" aria-hidden="true" data-backdrop="static">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="add-job-modal-title">Добавить новую работу</h3>
        <button class="icon-btn close-btn" id="close-add-job-modal" aria-label="Закрыть">&times;</button>
      </div>
      <div class="modal-body">
        <form id="add-job-form">
          <div class="form-row">
            <div class="form-group">
              <label for="job-date"><i class="fas fa-calendar-day"></i> Дата</label>
              <input type="date" id="job-date" required>
            </div>
            <div class="form-group">
              <label for="job-car"><i class="fas fa-car"></i> Автомобиль</label>
              <input type="text" id="job-car" placeholder="Марка, модель, гос. номер" required>
            </div>
          </div>

          <div class="form-group">
            <label for="job-client"><i class="fas fa-user"></i> Клиент</label>
            <input type="text" id="job-client" placeholder="Имя клиента">
          </div>

          <div class="form-group">
            <label for="job-services"><i class="fas fa-list"></i> Услуги</label>
            <div id="selected-services" class="services-tags">
              <!-- Выбранные услуги будут добавляться сюда -->
              <span class="placeholder-text">Нажмите для выбора услуг</span>
            </div>
            <input type="hidden" id="job-services" required>
          </div>
          <button type="button" id="select-services-btn" class="secondary-btn full-width">
            <i class="fas fa-plus"></i> Выбрать услуги
          </button>

          <div class="form-row">
            <div class="form-group">
              <label for="job-work-cost"><i class="fas fa-wrench"></i> Стоимость работ (₽)</label>
              <input type="number" id="job-work-cost" min="0" value="0" required>
            </div>
            <div class="form-group">
              <label for="job-parts-cost"><i class="fas fa-cogs"></i> Стоимость деталей (₽)</label>
              <input type="number" id="job-parts-cost" min="0" value="0">
            </div>
          </div>

          <div class="form-group">
            <label for="job-notes"><i class="fas fa-note-sticky"></i> Примечания</label>
            <textarea id="job-notes" rows="3" placeholder="Дополнительная информация"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="secondary-btn" id="cancel-job-btn">Отмена</button>
        <button class="primary-btn" id="save-job-btn" form="add-job-form">Сохранить</button>
      </div>
    </div>
  </div>

  <!-- Модальное окно выбора услуг -->
  <div id="services-modal" class="modal" role="dialog" aria-labelledby="services-modal-title" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="services-modal-title">Выбор услуг</h3>
        <button class="icon-btn close-btn" id="close-services-modal" aria-label="Закрыть">&times;</button>
      </div>
      <div class="modal-body">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="service-search" placeholder="Поиск услуг...">
        </div>
        
        <div class="services-list" id="services-list">
          <!-- Список услуг будет добавляться сюда -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="secondary-btn" id="cancel-services-btn">Отмена</button>
        <button class="primary-btn" id="services-confirm" disabled>Выбрать</button>
      </div>
    </div>
  </div>

  <!-- Модальное окно управления бонусами -->
  <div id="bonus-modal" class="modal" role="dialog" aria-labelledby="bonus-modal-title" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="bonus-modal-title">Управление бонусом</h3>
        <button class="icon-btn close-btn" id="close-bonus-modal" aria-label="Закрыть">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Мастер: <span id="bonus-master-name"></span></label>
          <p class="text-muted" id="bonus-master-stats"></p>
        </div>

        <div class="form-group">
          <label for="bonus-slider">Уровень бонуса: <span id="bonus-amount">0</span>/10</label>
          <input type="range" id="bonus-slider" min="0" max="10" value="0">
          <div class="bonus-display">
            <div class="bonus-stars" id="bonus-stars-display"></div>
            <div class="bonus-value" id="bonus-value-display">0%</div>
          </div>
        </div>

        <div class="form-group">
          <label>История изменений</label>
          <div class="chart-container small">
            <canvas id="bonus-history-chart"></canvas>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="secondary-btn" id="cancel-bonus-btn">Закрыть</button>
        <button class="primary-btn" id="save-bonus-btn">Сохранить</button>
      </div>
    </div>
  </div>

  <!-- Скрипты -->
  <script type="module" src="assets/js/theme.js"></script>
  <script type="module" src="assets/js/utils.js"></script>
  <script type="module" src="assets/js/storage.js"></script>
  <script type="module" src="assets/js/servicesCatalog.js"></script>
  <script type="module" src="assets/js/charts.js"></script>
  <script type="module" src="assets/js/app.js"></script>
</body>
</html>