<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>VIPавто | Облачный бортовой журнал</title>
    <link rel="stylesheet" href="assets/css/reset.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
</head>
<body>
    <!-- Хедер -->
    <header class="page-header">
        <div class="page-header__left">
            <h1 class="app-logo">VIPавто</h1>
            <p class="app-tagline">облачный бортовой журнал</p>
        </div>
        <div class="page-header__center">
            <span id="current-date">…</span>
            <span id="current-time">–:–:–</span>
        </div>
        <div class="page-header__right">
            <div class="user-menu">
                <button id="user-menu-btn" class="user-menu-trigger">
                    <i class="fas fa-user-circle"></i>
                    <span id="user-name">Загрузка...</span>
                </button>
                <div class="user-menu-dropdown hidden">
                    <div class="user-info">
                        <p class="user-role" id="user-role">Загрузка...</p>
                        <p class="user-position" id="user-position">Загрузка...</p>
                    </div>
                    <hr>
                    <button id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Выйти
                    </button>
                </div>
            </div>
            <label class="theme-switch">
                <input type="checkbox" id="theme-toggle" />
                <span class="slider">
                    <span class="slider-thumb">
                        <i class="fas fa-moon"></i>
                        <i class="fas fa-sun"></i>
                    </span>
                </span>
            </label>
        </div>
    </header>

    <!-- Основной контент -->
    <div class="container">
        <!-- Навигация -->
        <nav class="main-nav">
            <button id="nav-journal" class="nav-btn active">
                <i class="fas fa-book"></i> Журнал
            </button>
            <button id="nav-analytics" class="nav-btn">
                <i class="fas fa-chart-line"></i> Аналитика
            </button>
            <button id="nav-masters" class="nav-btn director-only hidden">
                <i class="fas fa-users"></i> Мастера
            </button>
            <button id="nav-settings" class="nav-btn">
                <i class="fas fa-cog"></i> Настройки
            </button>
        </nav>

        <!-- Секции контента -->
        <main class="main-content">
            <!-- 1. Журнал -->
            <section id="journal-section" class="content-section">
                <!-- Форма добавления записи -->
                <div class="entry-form card">
                    <h2>Добавить запись</h2>
                    <form id="entry-form">
                        <div class="form-row">
                            <label>
                                Дата:
                                <input type="date" id="entry-date" required>
                            </label>
                            <label>
                                Мастер:
                                <select id="entry-master" required>
                                    <option value="" disabled selected>Выберите мастера</option>
                                </select>
                            </label>
                        </div>
                        <div class="form-row">
                            <label>
                                Автомобиль:
                                <input type="text" id="entry-car" placeholder="Марка и модель" required>
                            </label>
                        </div>
                        <div class="form-row">
                            <label>
                                Услуги:
                                <div id="services-selector" class="services-field">
                                    Нажмите, чтобы выбрать услуги...
                                </div>
                            </label>
                        </div>
                        <div class="form-row">
                            <label>
                                Работа (₽):
                                <input type="number" id="entry-work-cost" min="0" required>
                            </label>
                            <label>
                                Запчасти (₽):
                                <input type="number" id="entry-parts-cost" min="0" required>
                            </label>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Добавить
                            </button>
                            <button type="reset" class="btn btn-secondary">
                                <i class="fas fa-undo"></i> Сбросить
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Записи журнала -->
                <div class="journal-entries card">
                    <div class="card-header">
                        <h2>Записи журнала</h2>
                        <div class="card-tools">
                            <input type="search" id="journal-search" 
                                   placeholder="Поиск по записям...">
                            <select id="journal-filter">
                                <option value="all">Все записи</option>
                                <option value="today">Сегодня</option>
                                <option value="week">Эта неделя</option>
                                <option value="month">Этот месяц</option>
                            </select>
                        </div>
                    </div>
                    <div id="entries-list"></div>
                </div>
            </section>

            <!-- 2. Аналитика -->
            <section id="analytics-section" class="content-section hidden">
                <!-- KPI панель -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <h3>Общая выручка</h3>
                        <p id="kpi-revenue">0 ₽</p>
                        <span class="kpi-trend positive">
                            <i class="fas fa-arrow-up"></i> +5.2%
                        </span>
                    </div>
                    <div class="kpi-card">
                        <h3>Прибыль сервиса</h3>
                        <p id="kpi-profit">0 ₽</p>
                        <span class="kpi-trend positive">
                            <i class="fas fa-arrow-up"></i> +3.8%
                        </span>
                    </div>
                    <div class="kpi-card">
                        <h3>Выплаты мастерам</h3>
                        <p id="kpi-payouts">0 ₽</p>
                        <span class="kpi-trend neutral">
                            <i class="fas fa-minus"></i> 0%
                        </span>
                    </div>
                    <div class="kpi-card">
                        <h3>Количество работ</h3>
                        <p id="kpi-jobs">0</p>
                        <span class="kpi-trend positive">
                            <i class="fas fa-arrow-up"></i> +12.5%
                        </span>
                    </div>
                </div>

                <!-- Графики -->
                <div class="charts-grid">
                    <div class="card">
                        <h3>Выручка по дням</h3>
                        <canvas id="revenue-chart"></canvas>
                    </div>
                    <div class="card">
                        <h3>Распределение работ</h3>
                        <canvas id="masters-chart"></canvas>
                    </div>
                </div>
            </section>

            <!-- 3. Мастера (только для директора) -->
            <section id="masters-section" class="content-section hidden">
                <div class="masters-grid" id="masters-grid">
                    <!-- Карточки мастеров генерируются динамически -->
                </div>
            </section>

            <!-- 4. Настройки -->
            <section id="settings-section" class="content-section hidden">
                <div class="card">
                    <h2>Настройки профиля</h2>
                    <!-- Настройки добавим позже -->
                </div>
            </section>
        </main>
    </div>

    <!-- Модальные окна -->
    <!-- 1. Выбор услуг -->
    <div id="services-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Выбор услуг</h3>
                <input type="search" id="service-search" 
                       placeholder="Поиск услуг...">
            </div>
            <div class="modal-body">
                <div class="services-tabs">
                    <button class="tab-btn active">Все услуги</button>
                    <button class="tab-btn">Избранные</button>
                    <button class="tab-btn">Последние</button>
                </div>
                <div id="services-list"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="services-cancel">
                    Отмена
                </button>
                <button class="btn btn-primary" id="services-confirm">
                    Подтвердить
                </button>
            </div>
        </div>
    </div>

    <!-- 2. Модальное окно бонусов (для директора) -->
    <div id="bonus-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Система бонусов "Мастер+"</h3>
                <p id="bonus-master-name"></p>
            </div>
            <div class="modal-body">
                <div class="bonus-controls">
                    <div class="bonus-slider-wrap">
                        <input type="range" id="bonus-slider" 
                               min="0" max="10" step="1" value="0">
                        <div class="bonus-scale">
                            <span>0%</span>
                            <span>+10%</span>
                            <span>+20%</span>
                        </div>
                    </div>
                    <div class="bonus-info">
                        <p>Текущий бонус: <span id="current-bonus">+0%</span></p>
                        <p>Сумма бонуса: <span id="bonus-amount">0 ₽</span></p>
                    </div>
                </div>
                <div class="bonus-criteria">
                    <h4>Критерии оценки:</h4>
                    <ul>
                        <li>Качество работы</li>
                        <li>Сложность задач</li>
                        <li>Количество работ</li>
                        <li>Отзывы клиентов</li>
                        <li>Соблюдение сроков</li>
                        <li>Чистота рабочего места</li>
                        <li>Работа в команде</li>
                    </ul>
                </div>
                <div class="bonus-comment">
                    <label for="bonus-comment-input">
                        Комментарий к оценке:
                    </label>
                    <textarea id="bonus-comment-input" 
                              placeholder="Опишите причины выставленной оценки...">
                    </textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="bonus-cancel">
                    Отмена
                </button>
                <button class="btn btn-primary" id="bonus-confirm">
                    Сохранить
                </button>
            </div>
        </div>
    </div>

    <!-- Скрипты -->
    <script type="module" src="assets/js/app.js"></script>
    <script type="module" src="assets/js/charts.js"></script>
    <script type="module" src="assets/js/theme.js"></script>
    <script type="module" src="assets/js/storage.js"></script>
    <script type="module" src="assets/js/utils.js"></script>
    <script type="module" src="assets/js/servicesCatalog.js"></script>
</body>
</html>
